<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
            rel="stylesheet"
            integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
            crossorigin="anonymous"
    />
    <link
            href="https://font.elice.io/css?family=Elice+DX+Neolli"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />

    <style>
        html,
        body {
            font-family: "Elice DX Neolli", sans-serif;
        }

        .dropdown-toggle:after {
            content: none;
        }

        .comment .btn-group {
            display: none;
        }

        .comment:hover .btn-group {
            display: flex;
        }
    </style>
    <title th:text="${post.postTitle}"></title>
</head>
<body>
<!--<div class="header mb-3">-->
<!--    <h2 class="text-start" th:text="${post.postTitle}"></h2>-->
<!--</div>-->
<!--<p class="m-0" th:text="${post.postContent}"></p>-->
    <div class="container my-5 mx-auto">
<!--        <a-->
<!--                class="link link-offset-1 link-offset-2-hover text-sm fs-6 mb-2 d-block"-->
<!--                style="transition: all 0.1s ease-in-out"-->
<!--                th:href="@{/boards/{boardId}(boardId=${post.board.id})}"-->
<!--        >&larr; 게시판으로 돌아가기</a-->
<!--        >-->
        <div class="container border rounded p-4 position-relative">
            <div class="header mb-3">
                <h2 class="text-start" th:text="${post.postTitle}">게시글 제목</h2>
            </div>
            <p class="m-0" th:text="${post.postContent}">게시글 내용</p>
            <hr class="mt-4" />

<!--            수정/삭제버튼-->
            <div class="position-absolute top-0 end-0 mt-4 me-4">
                <button
                        class="btn btn-light lh-1 p-0 px-2 dropdown-toggle"
                        type="button"
                        data-bs-toggle="dropdown"
                        aria-expanded="false"
                >
                    <span class="material-symbols-outlined"> more_horiz </span>
                </button>
                <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                        <button
                                class="dropdown-item d-flex align-items-center gap-2"
                                th:onclick="'location.href=\'/posts/' + ${post.id} + '/edit\''"
                        >
                            <span class="material-symbols-outlined"> edit </span>수정
                        </button>
                    </li>
                    <li>
                        <button
                                class="dropdown-item text-danger btn btn-danger d-flex align-items-center gap-2"
                                data-bs-toggle="modal"
                                data-bs-target="#deletePostModal"
                                th:onclick="handleDeletePostButton(event, [[${post.id}]], [[${post.board.id}]]);"
                        >
                            <span class="material-symbols-outlined"> delete </span>삭제
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </div>
<!--    게시글 삭제 폼-->
<div
        class="modal fade"
        id="deletePostModal"
        tabindex="-1"
        aria-labelledby="deletePostModalLabel"
        aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="deletePostModalLabel">
                    게시글을 삭제하시겠습니까?
                </h1>
                <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <p class="fw-light">게시글과 댓글이 삭제됩니다.</p>
            </div>
            <div class="modal-footer">
                <button
                        type="button"
                        class="btn btn-secondary"
                        data-bs-dismiss="modal"
                >
                    취소
                </button>
                <button
                        type="button"
                        class="btn btn-danger"
                        onclick="handleDeletePostModalButton()"
                >
                    삭제
                </button>
            </div>
        </div>
    </div>
</div>

<!-- 부트스트랩 JS 추가 -->
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous"
></script>
<script th:inline="javascript">
    let currentPost;
    let currentBoard;
    let currentTheme;

    function handleDeletePostButton(_, postId, boardId, themeId) {
        currentPost = postId;
        currentBoard = boardId;
        currentTheme = themeId;
    }
    function handleDeletePostModalButton() {
        fetch(`/posts/${currentPost}`, {
            method: "DELETE",
        }).then(() => {
            if (currentBoard) {
                window.location.href = `/boards/${currentBoard}`;
            } else if (currentTheme) {
                window.location.href = `/themes/${currentTheme}`;
            } else {
                // 기본 경로로 리디렉션
                window.location.href = '/';
            }
        });
    }
</script>

</body>
</html>
